<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Relat√≥rios - Bet Tracker Pro</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        color: #1a202c;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
      }

      .header {
        text-align: center;
        color: white;
        margin-bottom: 40px;
        padding: 40px 20px;
        backdrop-filter: blur(10px);
        background: rgba(255, 255, 255, 0.1);
        border-radius: 20px;
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .header h1 {
        font-size: 3rem;
        font-weight: 700;
        margin-bottom: 10px;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
      }

      .header p {
        font-size: 1.2rem;
        opacity: 0.9;
      }

      .back-button {
        position: fixed;
        top: 20px;
        left: 20px;
        background: rgba(255, 255, 255, 0.9);
        color: #4a5568;
        padding: 12px 20px;
        border: none;
        border-radius: 50px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        z-index: 1000;
      }

      .back-button:hover {
        background: white;
        transform: translateY(-2px);
        box-shadow: 0 6px 25px rgba(0, 0, 0, 0.15);
      }

      .filters-section {
        background: white;
        padding: 30px;
        border-radius: 20px;
        margin-bottom: 30px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .filters-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        align-items: end;
      }

      .filter-group {
        display: flex;
        flex-direction: column;
      }

      .filter-group label {
        font-weight: 600;
        color: #4a5568;
        margin-bottom: 8px;
        font-size: 14px;
      }

      .filter-group select,
      .filter-group input {
        padding: 12px 16px;
        border: 2px solid #e2e8f0;
        border-radius: 12px;
        font-size: 14px;
        transition: all 0.3s ease;
        background: white;
      }

      .filter-group select:focus,
      .filter-group input:focus {
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        outline: none;
      }

      .apply-filters-btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 12px 30px;
        border: none;
        border-radius: 12px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
      }

      .apply-filters-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
      }

      .dashboard-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 30px;
        margin-bottom: 40px;
      }

      .chart-card {
        background: white;
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        transition: all 0.3s ease;
      }

      .chart-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
      }

      .chart-title {
        font-size: 1.4rem;
        font-weight: 700;
        color: #2d3748;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .chart-container {
        position: relative;
        height: 300px;
        margin-bottom: 20px;
      }

      .stats-overview {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 40px;
      }

      .stat-item {
        background: white;
        padding: 25px;
        border-radius: 16px;
        text-align: center;
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        transition: all 0.3s ease;
      }

      .stat-item:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 45px rgba(0, 0, 0, 0.15);
      }

      .stat-value {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 8px;
      }

      .stat-label {
        color: #718096;
        font-weight: 500;
        font-size: 14px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .insights-section {
        background: white;
        border-radius: 20px;
        padding: 40px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        margin-bottom: 30px;
      }

      .insights-title {
        font-size: 1.8rem;
        font-weight: 700;
        color: #2d3748;
        margin-bottom: 25px;
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .insight-item {
        background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
        padding: 20px;
        border-radius: 12px;
        margin-bottom: 15px;
        border-left: 4px solid #667eea;
        transition: all 0.3s ease;
      }

      .insight-item:hover {
        transform: translateX(5px);
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
      }

      .insight-text {
        font-size: 16px;
        color: #4a5568;
        line-height: 1.6;
      }

      .trend-indicator {
        display: inline-flex;
        align-items: center;
        gap: 5px;
        padding: 4px 10px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
        margin-left: 10px;
      }

      .trend-up {
        background: #c6f6d5;
        color: #276749;
      }

      .trend-down {
        background: #fed7d7;
        color: #c53030;
      }

      .trend-stable {
        background: #bee3f8;
        color: #2b6cb0;
      }

      .detailed-table {
        background: white;
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        overflow-x: auto;
      }

      .table-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: #2d3748;
        margin-bottom: 20px;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        border-radius: 12px;
        overflow: hidden;
      }

      th {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 15px;
        text-align: left;
        font-weight: 600;
        font-size: 14px;
      }

      td {
        padding: 12px 15px;
        border-bottom: 1px solid #e2e8f0;
        color: #4a5568;
      }

      tr:hover {
        background: #f7fafc;
      }

      .sport-icon {
        font-size: 18px;
        margin-right: 8px;
      }

      .result-badge {
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
        text-transform: uppercase;
      }

      .badge-green {
        background: #c6f6d5;
        color: #276749;
      }

      .badge-red {
        background: #fed7d7;
        color: #c53030;
      }

      .badge-cash {
        background: #fbb6ce;
        color: #97266d;
      }

      .loading-spinner {
        display: none;
        text-align: center;
        padding: 40px;
      }

      .spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #667eea;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
        margin: 0 auto 20px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      @media (max-width: 768px) {
        .header h1 {
          font-size: 2rem;
        }
        .dashboard-grid {
          grid-template-columns: 1fr;
        }
        .filters-grid {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <button class="back-button" onclick="window.location.href='index.html'">
      ‚Üê Voltar ao Dashboard
    </button>

    <div class="container">
      <div class="header">
        <h1>üìä Relat√≥rios Avan√ßados</h1>
        <p>An√°lise profunda do seu desempenho em apostas esportivas</p>
      </div>

      <!-- Filtros -->
      <div class="filters-section">
        <div class="filters-grid">
          <div class="filter-group">
            <label>üóìÔ∏è Per√≠odo</label>
            <select id="periodFilter">
              <option value="todos">Todos os Meses</option>
              <option value="setembro">Setembro</option>
              <option value="outubro">Outubro</option>
              <option value="novembro">Novembro</option>
              <option value="dezembro">Dezembro</option>
            </select>
          </div>
          <div class="filter-group">
            <label>‚öΩ Esporte</label>
            <select id="sportFilter">
              <option value="todos">Todos os Esportes</option>
              <option value="futebol">‚öΩ Futebol</option>
              <option value="basquete">üèÄ Basquete</option>
              <option value="tenis">üéæ T√™nis</option>
              <option value="volei">üèê V√¥lei</option>
              <option value="ufc">ü•ä UFC/MMA</option>
              <option value="esports">üéÆ E-Sports</option>
            </select>
          </div>
          <div class="filter-group">
            <label>üéØ Resultado</label>
            <select id="resultFilter">
              <option value="todos">Todos os Resultados</option>
              <option value="green">Green</option>
              <option value="red">Red</option>
              <option value="cash">Cash Out</option>
              <option value="pending">Pendente</option>
            </select>
          </div>
          <div class="filter-group">
            <label>üí∞ Confian√ßa</label>
            <select id="confidenceFilter">
              <option value="todos">Todas as Confian√ßas</option>
              <option value="20">20%</option>
              <option value="40">40%</option>
              <option value="60">60%</option>
              <option value="80">80%</option>
              <option value="100">100%</option>
            </select>
          </div>
          <div class="filter-group">
            <button class="apply-filters-btn" onclick="applyFilters()">
              üîç Aplicar Filtros
            </button>
          </div>
        </div>
      </div>

      <!-- Loading -->
      <div class="loading-spinner" id="loadingSpinner">
        <div class="spinner"></div>
        <p>Processando dados...</p>
      </div>

      <!-- Estat√≠sticas Gerais -->
      <div class="stats-overview" id="statsOverview">
        <!-- Stats ser√£o inseridas aqui dinamicamente -->
      </div>

      <!-- Gr√°ficos Dashboard -->
      <div class="dashboard-grid">
        <div class="chart-card">
          <div class="chart-title">üìà Evolu√ß√£o Mensal</div>
          <div class="chart-container">
            <canvas id="monthlyChart"></canvas>
          </div>
        </div>

        <div class="chart-card">
          <div class="chart-title">üéØ Assertividade por Esporte</div>
          <div class="chart-container">
            <canvas id="sportChart"></canvas>
          </div>
        </div>

        <div class="chart-card">
          <div class="chart-title">üí∞ Distribui√ß√£o de Resultados</div>
          <div class="chart-container">
            <canvas id="resultsChart"></canvas>
          </div>
        </div>

        <div class="chart-card">
          <div class="chart-title">üìä ROI por Confian√ßa</div>
          <div class="chart-container">
            <canvas id="confidenceChart"></canvas>
          </div>
        </div>
      </div>

      <!-- Insights Inteligentes -->
      <div class="insights-section">
        <div class="insights-title">üß† Insights Inteligentes</div>
        <div id="insightsContainer">
          <!-- Insights ser√£o inseridos aqui -->
        </div>
      </div>

      <!-- Tabela Detalhada -->
      <div class="detailed-table">
        <div class="table-title">üìã An√°lise Detalhada por Aposta</div>
        <table id="detailedTable">
          <thead>
            <tr>
              <th>Data</th>
              <th>Esporte</th>
              <th>Jogo</th>
              <th>M√©todo</th>
              <th>Confian√ßa</th>
              <th>Odd</th>
              <th>Valor</th>
              <th>Resultado</th>
              <th>ROI</th>
            </tr>
          </thead>
          <tbody>
            <!-- Dados ser√£o inseridos aqui -->
          </tbody>
        </table>
      </div>
    </div>

    <script>
      // Dados simulados - em produ√ß√£o, viria do localStorage
      let allBetsData = {};
      let filteredData = [];
      let charts = {};

      // Carregar dados do localStorage
      function loadBetsData() {
        const savedBets = localStorage.getItem("betsData");
        const savedMultiplas = localStorage.getItem("multiplaData");

        if (savedBets) {
          allBetsData = JSON.parse(savedBets);
        } else {
          // Dados de exemplo para demonstra√ß√£o
          allBetsData = {
            setembro: [
              {
                data: "2024-09-01",
                esporte: "futebol",
                evento: "Flamengo x Palmeiras",
                metodo: "Over 2.5",
                confianca: "80%",
                odd: "1.75",
                unidade: "2",
                resultado: "green",
                casaApostas: "bet365",
              },
              {
                data: "2024-09-05",
                esporte: "basquete",
                evento: "Lakers x Warriors",
                metodo: "Handicap +5.5",
                confianca: "60%",
                odd: "1.90",
                unidade: "1.5",
                resultado: "red",
                casaApostas: "betano",
              },
              {
                data: "2024-09-10",
                esporte: "tenis",
                evento: "Djokovic x Nadal",
                metodo: "Vencedor",
                confianca: "100%",
                odd: "2.20",
                unidade: "3",
                resultado: "green",
                casaApostas: "superbet",
              },
            ],
            outubro: [
              {
                data: "2024-10-02",
                esporte: "futebol",
                evento: "Barcelona x Real Madrid",
                metodo: "BTTS",
                confianca: "40%",
                odd: "1.65",
                unidade: "1",
                resultado: "red",
                casaApostas: "bet365",
              },
            ],
          };
        }
      }

      // Aplicar filtros
      function applyFilters() {
        showLoading();

        setTimeout(() => {
          const period = document.getElementById("periodFilter").value;
          const sport = document.getElementById("sportFilter").value;
          const result = document.getElementById("resultFilter").value;
          const confidence = document.getElementById("confidenceFilter").value;

          filteredData = [];

          const monthsToInclude =
            period === "todos"
              ? ["setembro", "outubro", "novembro", "dezembro"]
              : [period];

          monthsToInclude.forEach((month) => {
            if (allBetsData[month]) {
              allBetsData[month].forEach((bet) => {
                let include = true;

                if (sport !== "todos" && bet.esporte !== sport) include = false;
                if (result !== "todos" && bet.resultado !== result)
                  include = false;
                if (
                  confidence !== "todos" &&
                  parseInt(bet.confianca) !== parseInt(confidence)
                )
                  include = false;

                if (include) {
                  filteredData.push({ ...bet, month });
                }
              });
            }
          });

          hideLoading();
          updateDashboard();
        }, 1000);
      }

      // Mostrar/ocultar loading
      function showLoading() {
        document.getElementById("loadingSpinner").style.display = "block";
        document.getElementById("statsOverview").style.opacity = "0.5";
      }

      function hideLoading() {
        document.getElementById("loadingSpinner").style.display = "none";
        document.getElementById("statsOverview").style.opacity = "1";
      }

      // Atualizar dashboard
      function updateDashboard() {
        updateStatsOverview();
        updateCharts();
        updateInsights();
        updateDetailedTable();
      }

      // Atualizar estat√≠sticas gerais
      function updateStatsOverview() {
        const stats = calculateStats(filteredData);
        const container = document.getElementById("statsOverview");

        container.innerHTML = `
          <div class="stat-item">
            <div class="stat-value" style="color: #38a169;">${
              stats.totalBets
            }</div>
            <div class="stat-label">Total de Apostas</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" style="color: #3182ce;">${
              stats.winRate
            }%</div>
            <div class="stat-label">Taxa de Acerto</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" style="color: ${
              stats.totalProfit >= 0 ? "#38a169" : "#e53e3e"
            };">
              R$ ${stats.totalProfit.toFixed(2)}
            </div>
            <div class="stat-label">Lucro Total</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" style="color: ${
              stats.roi >= 0 ? "#38a169" : "#e53e3e"
            };">
              ${stats.roi >= 0 ? "+" : ""}${stats.roi}%
            </div>
            <div class="stat-label">ROI M√©dio</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" style="color: #805ad5;">R$ ${
              stats.avgOdd
            }</div>
            <div class="stat-label">Odd M√©dia</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" style="color: #d69e2e;">${
              stats.bestSport
            }</div>
            <div class="stat-label">Melhor Esporte</div>
          </div>
        `;
      }

      // Calcular estat√≠sticas
      function calculateStats(data) {
        if (!data.length)
          return {
            totalBets: 0,
            winRate: 0,
            totalProfit: 0,
            roi: 0,
            avgOdd: 0,
            bestSport: "N/A",
          };

        const totalBets = data.length;
        const wins = data.filter((bet) => bet.resultado === "green").length;
        const winRate = ((wins / totalBets) * 100).toFixed(1);

        let totalProfit = 0;
        let totalStaked = 0;
        let totalOdd = 0;
        const sportStats = {};

        data.forEach((bet) => {
          const odd = parseFloat(bet.odd) || 1;
          const stake = (parseFloat(bet.unidade) || 1) * 50;

          totalOdd += odd;
          totalStaked += stake;

          if (bet.resultado === "green") {
            totalProfit += odd * stake - stake;
          } else if (bet.resultado === "red") {
            totalProfit -= stake;
          }

          // Stats por esporte
          if (!sportStats[bet.esporte]) {
            sportStats[bet.esporte] = { wins: 0, total: 0 };
          }
          sportStats[bet.esporte].total++;
          if (bet.resultado === "green") {
            sportStats[bet.esporte].wins++;
          }
        });

        const roi =
          totalStaked > 0 ? ((totalProfit / totalStaked) * 100).toFixed(1) : 0;
        const avgOdd = (totalOdd / totalBets).toFixed(2);

        // Melhor esporte
        let bestSport = "N/A";
        let bestWinRate = 0;
        Object.entries(sportStats).forEach(([sport, stats]) => {
          const winRate =
            stats.total > 0 ? (stats.wins / stats.total) * 100 : 0;
          if (winRate > bestWinRate && stats.total >= 3) {
            bestWinRate = winRate;
            bestSport = sport;
          }
        });

        return { totalBets, winRate, totalProfit, roi, avgOdd, bestSport };
      }

      // Atualizar gr√°ficos
      function updateCharts() {
        updateMonthlyChart();
        updateSportChart();
        updateResultsChart();
        updateConfidenceChart();
      }

      // Gr√°fico mensal
      function updateMonthlyChart() {
        const ctx = document.getElementById("monthlyChart").getContext("2d");

        if (charts.monthly) {
          charts.monthly.destroy();
        }

        const monthlyData = {};
        ["setembro", "outubro", "novembro", "dezembro"].forEach((month) => {
          monthlyData[month] = { profit: 0, bets: 0 };
        });

        filteredData.forEach((bet) => {
          const month = bet.month;
          const stake = (parseFloat(bet.unidade) || 1) * 50;
          const odd = parseFloat(bet.odd) || 1;

          monthlyData[month].bets++;

          if (bet.resultado === "green") {
            monthlyData[month].profit += odd * stake - stake;
          } else if (bet.resultado === "red") {
            monthlyData[month].profit -= stake;
          }
        });

        const labels = Object.keys(monthlyData).map(
          (month) => month.charAt(0).toUpperCase() + month.slice(1)
        );
        const profits = Object.values(monthlyData).map((data) => data.profit);

        charts.monthly = new Chart(ctx, {
          type: "line",
          data: {
            labels: labels,
            datasets: [
              {
                label: "Lucro Mensal (R$)",
                data: profits,
                borderColor: "#667eea",
                backgroundColor: "rgba(102, 126, 234, 0.1)",
                borderWidth: 3,
                fill: true,
                tension: 0.4,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: true,
                position: "top",
              },
            },
            scales: {
              y: {
                beginAtZero: true,
                grid: {
                  color: "rgba(0,0,0,0.1)",
                },
              },
            },
          },
        });
      }

      // Gr√°fico por esporte
      function updateSportChart() {
        const ctx = document.getElementById("sportChart").getContext("2d");

        if (charts.sport) {
          charts.sport.destroy();
        }

        const sportStats = {};
        filteredData.forEach((bet) => {
          if (!sportStats[bet.esporte]) {
            sportStats[bet.esporte] = { wins: 0, total: 0 };
          }
          sportStats[bet.esporte].total++;
          if (bet.resultado === "green") {
            sportStats[bet.esporte].wins++;
          }
        });

        const sports = Object.keys(sportStats);
        const winRates = sports.map((sport) =>
          sportStats[sport].total > 0
            ? (
                (sportStats[sport].wins / sportStats[sport].total) *
                100
              ).toFixed(1)
            : 0
        );

        charts.sport = new Chart(ctx, {
          type: "doughnut",
          data: {
            labels: sports.map((sport) => {
              const icons = {
                futebol: "‚öΩ",
                basquete: "üèÄ",
                tenis: "üéæ",
                volei: "üèê",
                ufc: "ü•ä",
                esports: "üéÆ",
              };
              return `${icons[sport] || "üèÜ"} ${
                sport.charAt(0).toUpperCase() + sport.slice(1)
              }`;
            }),
            datasets: [
              {
                data: winRates,
                backgroundColor: [
                  "#667eea",
                  "#f093fb",
                  "#4facfe",
                  "#43e97b",
                  "#fa709a",
                  "#ffecd2",
                  "#a8edea",
                  "#fed6e3",
                ],
                borderWidth: 0,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: "bottom",
              },
              tooltip: {
                callbacks: {
                  label: function (context) {
                    return (
                      context.label + ": " + context.parsed + "% de acerto"
                    );
                  },
                },
              },
            },
          },
        });
      }

      // Gr√°fico de resultados
      function updateResultsChart() {
        const ctx = document.getElementById("resultsChart").getContext("2d");

        if (charts.results) {
          charts.results.destroy();
        }

        const resultCount = { green: 0, red: 0, cash: 0, pending: 0 };
        filteredData.forEach((bet) => {
          resultCount[bet.resultado] = (resultCount[bet.resultado] || 0) + 1;
        });

        charts.results = new Chart(ctx, {
          type: "bar",
          data: {
            labels: ["üü¢ Green", "üî¥ Red", "üí∞ Cash Out", "‚è≥ Pendente"],
            datasets: [
              {
                label: "Quantidade",
                data: [
                  resultCount.green,
                  resultCount.red,
                  resultCount.cash,
                  resultCount.pending,
                ],
                backgroundColor: ["#38a169", "#e53e3e", "#d69e2e", "#718096"],
                borderRadius: 8,
                borderSkipped: false,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: false,
              },
            },
            scales: {
              y: {
                beginAtZero: true,
                grid: {
                  color: "rgba(0,0,0,0.1)",
                },
              },
            },
          },
        });
      }

      // Gr√°fico ROI por confian√ßa
      function updateConfidenceChart() {
        const ctx = document.getElementById("confidenceChart").getContext("2d");

        if (charts.confidence) {
          charts.confidence.destroy();
        }

        const confidenceStats = {};
        filteredData.forEach((bet) => {
          const conf = parseInt(bet.confianca);
          if (!confidenceStats[conf]) {
            confidenceStats[conf] = { profit: 0, staked: 0 };
          }

          const stake = (parseFloat(bet.unidade) || 1) * 50;
          const odd = parseFloat(bet.odd) || 1;

          confidenceStats[conf].staked += stake;

          if (bet.resultado === "green") {
            confidenceStats[conf].profit += odd * stake - stake;
          } else if (bet.resultado === "red") {
            confidenceStats[conf].profit -= stake;
          }
        });

        const confidenceLevels = Object.keys(confidenceStats).sort(
          (a, b) => a - b
        );
        const rois = confidenceLevels.map((conf) => {
          const stats = confidenceStats[conf];
          return stats.staked > 0
            ? ((stats.profit / stats.staked) * 100).toFixed(1)
            : 0;
        });

        charts.confidence = new Chart(ctx, {
          type: "radar",
          data: {
            labels: confidenceLevels.map((conf) => `${conf}% Confian√ßa`),
            datasets: [
              {
                label: "ROI (%)",
                data: rois,
                borderColor: "#764ba2",
                backgroundColor: "rgba(118, 75, 162, 0.2)",
                borderWidth: 3,
                pointBackgroundColor: "#667eea",
                pointBorderColor: "#fff",
                pointBorderWidth: 2,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: "top",
              },
            },
            scales: {
              r: {
                beginAtZero: true,
                grid: {
                  color: "rgba(0,0,0,0.1)",
                },
              },
            },
          },
        });
      }

      // Atualizar insights
      function updateInsights() {
        const stats = calculateStats(filteredData);
        const container = document.getElementById("insightsContainer");

        const insights = [];

        // Insight sobre taxa de acerto
        if (stats.winRate >= 70) {
          insights.push({
            text: `üéØ Excelente! Sua taxa de acerto est√° em ${stats.winRate}%, muito acima da m√©dia do mercado (55%).`,
            trend: "up",
          });
        } else if (stats.winRate >= 50) {
          insights.push({
            text: `üìä Sua taxa de acerto (${stats.winRate}%) est√° na m√©dia. Foque em melhorar a sele√ß√£o de apostas.`,
            trend: "stable",
          });
        } else {
          insights.push({
            text: `‚ö†Ô∏è Taxa de acerto baixa (${stats.winRate}%). Revise sua estrat√©gia e seja mais seletivo.`,
            trend: "down",
          });
        }

        // Insight sobre ROI
        if (stats.roi > 10) {
          insights.push({
            text: `üí∞ ROI fant√°stico de ${stats.roi}%! Voc√™ est√° superando o mercado significativamente.`,
            trend: "up",
          });
        } else if (stats.roi > 0) {
          insights.push({
            text: `üìà ROI positivo de ${stats.roi}%. Continue assim, qualquer lucro no longo prazo √© sucesso.`,
            trend: "up",
          });
        } else {
          insights.push({
            text: `üìâ ROI negativo (${stats.roi}%). Analise suas perdas e ajuste o bankroll management.`,
            trend: "down",
          });
        }

        // Insight sobre melhor esporte
        if (stats.bestSport !== "N/A") {
          const sportIcons = {
            futebol: "‚öΩ",
            basquete: "üèÄ",
            tenis: "üéæ",
            volei: "üèê",
            ufc: "ü•ä",
            esports: "üéÆ",
          };
          insights.push({
            text: `${
              sportIcons[stats.bestSport] || "üèÜ"
            } Seu melhor esporte √© ${
              stats.bestSport
            }. Continue focando nesta modalidade!`,
            trend: "up",
          });
        }

        // Insight sobre volume de apostas
        if (filteredData.length < 10) {
          insights.push({
            text: `üìä Volume baixo de apostas (${filteredData.length}). Aumente gradualmente para ter dados mais consistentes.`,
            trend: "stable",
          });
        } else if (filteredData.length > 50) {
          insights.push({
            text: `üöÄ √ìtimo volume de apostas (${filteredData.length})! Dados suficientes para an√°lises confi√°veis.`,
            trend: "up",
          });
        }

        // Insight sobre odd m√©dia
        if (stats.avgOdd > 2.5) {
          insights.push({
            text: `üé≤ Odd m√©dia alta (${stats.avgOdd}). Apostas de maior risco podem trazer mais retorno, mas cuidado com o bankroll.`,
            trend: "stable",
          });
        } else if (stats.avgOdd < 1.8) {
          insights.push({
            text: `üõ°Ô∏è Odd m√©dia conservadora (${stats.avgOdd}). Boa para preservar capital, mas pode limitar lucros.`,
            trend: "stable",
          });
        }

        container.innerHTML = insights
          .map(
            (insight) => `
          <div class="insight-item">
            <div class="insight-text">
              ${insight.text}
              <span class="trend-indicator trend-${insight.trend}">
                ${
                  insight.trend === "up"
                    ? "‚ÜóÔ∏è Positivo"
                    : insight.trend === "down"
                    ? "‚ÜòÔ∏è Aten√ß√£o"
                    : "‚û°Ô∏è Neutro"
                }
              </span>
            </div>
          </div>
        `
          )
          .join("");
      }

      // Atualizar tabela detalhada
      function updateDetailedTable() {
        const tbody = document.querySelector("#detailedTable tbody");

        tbody.innerHTML = filteredData
          .map((bet) => {
            const stake = (parseFloat(bet.unidade) || 1) * 50;
            const odd = parseFloat(bet.odd) || 1;
            let profit = 0;
            let roi = 0;

            if (bet.resultado === "green") {
              profit = odd * stake - stake;
              roi = ((profit / stake) * 100).toFixed(1);
            } else if (bet.resultado === "red") {
              profit = -stake;
              roi = -100;
            }

            const sportIcons = {
              futebol: "‚öΩ",
              basquete: "üèÄ",
              tenis: "üéæ",
              volei: "üèê",
              ufc: "ü•ä",
              esports: "üéÆ",
            };

            return `
            <tr>
              <td>${new Date(bet.data).toLocaleDateString("pt-BR")}</td>
              <td>
                <span class="sport-icon">${
                  sportIcons[bet.esporte] || "üèÜ"
                }</span>
                ${bet.esporte.charAt(0).toUpperCase() + bet.esporte.slice(1)}
              </td>
              <td>${bet.evento || "N/A"}</td>
              <td>${bet.metodo || "N/A"}</td>
              <td>${bet.confianca}</td>
              <td>${parseFloat(bet.odd).toFixed(2)}</td>
              <td>R$ ${stake.toFixed(2)}</td>
              <td>
                <span class="result-badge badge-${bet.resultado}">
                  ${bet.resultado.toUpperCase()}
                </span>
              </td>
              <td style="color: ${
                roi >= 0 ? "#38a169" : "#e53e3e"
              }; font-weight: 600;">
                ${roi >= 0 ? "+" : ""}${roi}%
              </td>
            </tr>
          `;
          })
          .join("");
      }

      // Inicializa√ß√£o
      document.addEventListener("DOMContentLoaded", function () {
        loadBetsData();
        applyFilters(); // Aplicar filtros iniciais
      });

      // Adicionar funcionalidade de exportar relat√≥rio
      function exportReport() {
        const stats = calculateStats(filteredData);
        const reportData = {
          periodo: document.getElementById("periodFilter").value,
          data_geracao: new Date().toISOString(),
          estatisticas: stats,
          apostas: filteredData,
        };

        const blob = new Blob([JSON.stringify(reportData, null, 2)], {
          type: "application/json",
        });

        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `relatorio_apostas_${
          new Date().toISOString().split("T")[0]
        }.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }

      // Adicionar bot√£o de exportar
      document.querySelector(".filters-section").insertAdjacentHTML(
        "beforeend",
        `
        <div style="text-align: center; margin-top: 20px;">
          <button onclick="exportReport()" style="background: linear-gradient(135deg, #48bb78 0%, #38a169 100%); color: white; padding: 12px 24px; border: none; border-radius: 12px; font-weight: 600; cursor: pointer; margin-right: 10px;">
            üìä Exportar Relat√≥rio
          </button>
          <button onclick="window.print()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 12px 24px; border: none; border-radius: 12px; font-weight: 600; cursor: pointer;">
            üñ®Ô∏è Imprimir
          </button>
        </div>
      `
      );
    </script>
  </body>
</html>
